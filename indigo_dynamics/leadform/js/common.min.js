$(document).ready(function(){function e(e,a){return m.filter(function(n){return n[e]==a})}function a(e){$(".sp_popup_blocks").is(":visible")&&$(".sp_popup_blocks").fadeOut();var a=$(".sp_wrapper > .sp_l-centered"),i={welcome:0,reg:1,reg_success:2,login:3,info:4};e=e&&i[e]||0,r(),a.eq(e).is(":visible")||(n(),a.hide(),a.eq(e).show())}function n(){$("form .sp_form__error-cpt").remove(),$(".js-create-checkbox").prettyCheckable("check"),$("form .this-error").removeClass("this-error"),$("form")[0].reset(),_[0].selectize.setValue(""),$("[name=login_phone]").val("")}function i(){var e=$(".sp_popup");return!(!e.length||!e.is(":visible")||"login_error"!=e.data("type"))}function t(){var a=$("form"),n=["lastName","firstName","phone","addEmail"],i={},t=["address1","address2","zip","state","city"],r={},o=[];return n.forEach(function(e){i[e]=a.find("[name="+e+"]").val()}),t.forEach(function(n){if(a.find("[name="+n+"]").val())if("state"==n){var i=e("abbreviation",a.find("[name="+n+"]").val());i&&i.name&&(r[n]=i.name)}else r[n]=a.find("[name="+n+"]").val()}),a.find("[name=agree]").is(":checked")&&o.push(a.find("[name=agree]").data("tag")),{user_data:i,vars_data:r,tags_data:o}}function r(e){c&&clearTimeout(c),c=setTimeout(function(){a("welcome")},e||u)}function o(e,a){if(e&&e.title&&e.text){var n=$(".sp_popup");a?n.data("type",a):n.data("type",""),n.find(".sp_popup__head").html(e.title),n.find(".sp_popup__txt p").html(e.text),$(".sp_popup_blocks").animate({opacity:"toggle"},{duration:500,start:function(){$(this).css("display","table")}})}}function s(){a("reg_success"),r(15e3)}function l(e,a){function n(){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(a)}function i(){return 11===a.match(/\d/g).length}if(e&&a)return"email"==e?n():"phone"==e?i():!1}function b(e,a){function n(){var e=$('<div class="sp_form__error-cpt">\n    <div class="sp_form__error-cpt-inn">field is required</div>\n</div>');t.siblings(".sp_cmn-selectize").length?t.siblings(".sp_cmn-selectize").addClass("this-error"):t.addClass("this-error"),t.siblings(".sp_form__error-cpt").length||t.after(e)}function i(){t.siblings(".sp_cmn-selectize.this-error").length?t.siblings(".sp_cmn-selectize.this-error").removeClass("this-error"):t.removeClass("this-error"),t.siblings(".sp_form__error-cpt").length&&t.siblings(".sp_form__error-cpt").remove()}if(e&&$("[name="+e+"]").length&&a){var t=$("[name="+e+"]");if(t.data("required"))if("add"==a)n();else{if("del"!=a)return!1;i()}}}var c,u=6e4,m=[{name:"State",abbreviation:""},{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}],p={},d={partner_id:1573,lang:"en",domain:"https://sailplay.net"};SAILPLAY.send("init",d),SAILPLAY.on("init.success",function(){a(),r()});var v=SAILPLAY.url_params();v.p_name&&$(".p_name").text(v.p_name),$("body").on("click","[data-do]",function(e){var n=$(this);a(n.data("do")),e.preventDefault()}).on("submit","form.sp_form",function(e){function a(){var e=n.find(".this-error").length;if(0==e){var a=t().user_data;SAILPLAY.send("user.update",a)}}var n=$(this),i=n.serializeArray();$.each(i,function(t,r){if(r.value){var o=n.find("[name="+r.name+"]");"email"!=o.data("valid")&&"phone"!=o.data("valid")||l(o.data("valid"),o.val())?b(r.name,"del"):b(r.name,"add")}else b(r.name,"add");t==i.length-1&&a(),e.preventDefault(),e.stopPropagation()}),e.preventDefault()}).on("click",".btn_login",function(e){e.preventDefault();var a=$("[name=login_phone]").length&&$("[name=login_phone]").val();return l("phone",a)?($("[name=login_phone]").val(""),void SAILPLAY.send("load.user.info",{user:{phone:a},all:1})):(o({title:"Error",text:"Please enter a valid phone number (United States)"},"login_error"),void r(15e3))}).on("click",".sp_popup__close",function(e){e.preventDefault(),$(".sp_popup_blocks").fadeOut(),$(".sp_popup").data("type",""),r()}).on("click touchstart",function(){i()||r()}).on("keyup","input",function(){i()||r()}),SAILPLAY.on("user.update.error",function(e){var a={"-200008":{title:"This phone number is already in use.",text:'Dear customer, if you are already registered, you can <span class="sp_popup__close this-link" data-do="login">check your bonus points by providing you phone number</span>.'},"-200010":{title:"This email is already in use by someone else.",text:'Dear customer, please use another email. If you are already registered, you can <span class="sp_popup__close this-link" data-do="login">check your bonus points by providing you phone number</span>. If you want to update your profile please ask a cashier for help.'}};o(a[e.status_code]||{})}),SAILPLAY.on("user.update.success",function(e){var a=t();SAILPLAY.send("vars.add",{custom_vars:a.vars_data,user:{phone:a.user_data.phone}},function(){a.tags_data.length?SAILPLAY.send("tags.add",{tags:a.tags_data,user:{phone:a.user_data.phone}},function(){s()}):s()})}),SAILPLAY.on("load.user.info.success",function(e){$(".user_points").text(e.user_points.confirmed),$(".user_name").text(e.user.first_name+" "+e.user.last_name),a("info"),r(15e3)}),SAILPLAY.on("load.user.info.error",function(e){o({title:"Error",text:"Customer with such phone number is not registered"},"login_error"),r(15e3)}),$(".js-create-checkbox").each(function(){$(this).prettyCheckable({customClass:"sp_cmn-checkbox-wr js-target"})}),$(".js-satellite").click(function(){$(this).siblings(".js-target").find("a").trigger("click")});var f={name:"City",value:""},h=$(".js-create-select#city").selectize({options:f,labelField:"name",valueField:"value",sortField:"value"});h[0].selectize.setValue(""),h[0].selectize.disable();var _=$(".js-create-select#state").selectize({options:m,labelField:"name",valueField:"abbreviation",sortField:"abbreviation",onChange:function(e){function a(e){var a=[];a=e.map(function(e){return{name:e.name,value:e.name}}),h[0].selectize.load(function(e){e(a)}),h[0].selectize.enable()}if(h[0].selectize.clear(),h[0].selectize.clearOptions(),h[0].selectize.addOption([f]),h[0].selectize.setValue(""),e)if(p[e])a(p[e]);else{var n="js/json/states/"+e+"_cities.json";$.get(n).done(function(n){p[e]=n,a(n)})}else h[0].selectize.disable()}});_[0].selectize.setValue("")});